Letâ€™s clearly understand:

ğŸ”¹ dependent: :nullify

It is used with:

has_many

has_one

It controls what happens to child records when the parent is deleted.

ğŸ§± Example
class User < ApplicationRecord
  has_many :posts, dependent: :nullify
end

class Post < ApplicationRecord
  belongs_to :user
end


Assume database:

users
id = 1 (Rahul)
posts
id = 10, user_id = 1
id = 11, user_id = 1
ğŸ”¥ What Happens When You Delete User?
user.destroy


With:

dependent: :nullify


Rails will:

UPDATE posts SET user_id = NULL WHERE user_id = 1;
DELETE FROM users WHERE id = 1;

âœ… Result

Posts still exist:

id	user_id
10	NULL
11	NULL

User is deleted.
Posts are not deleted.

The relationship is removed.

ğŸ§  Simple Meaning

"Remove the association, but keep the child records."

ğŸ” When Is This Useful?

When child records can exist independently.

Examples:

If a user deletes account, posts may stay for audit

If employee leaves, tasks still remain in system

Referral system where referred users shouldn't be deleted

âš ï¸ Important Thing

The foreign key column must allow NULL.

In migration:

t.references :user, null: true


If you have:

null: false


Then :nullify will fail.

ğŸ” Comparison With Other dependent Options

| Option                     | What Happens                                 |
| -------------------------- | -------------------------------------------- |
| `:destroy`                 | Deletes children one by one (runs callbacks) |
| `:delete_all`              | Deletes children directly (no callbacks)     |
| `:nullify`                 | Sets foreign key to NULL                     |
| `:restrict_with_error`     | Prevents deletion if children exist          |
| `:restrict_with_exception` | Raises error                                 |

ğŸ§  Very Important Difference


:destroy

Runs callbacks like:

before_destroy
after_destroy

:nullify

Does NOT run child callbacks.
It only updates foreign key.

ğŸ¯ Real Example From Your Referral Case
has_many :referrals,
         class_name: "User",
         foreign_key: :referred_by_id,
         dependent: :nullify


If Rahul is deleted:

Amit and Neha are NOT deleted

Their referred_by_id becomes NULL

They simply lose their referrer.

ğŸ’¡ Interview-Level Understanding

If interviewer asks:

Why choose nullify over destroy?

Answer:

Because child records must survive independently. We only want to remove the relationship, not delete business data.