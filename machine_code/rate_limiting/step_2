ğŸ¯ Step 2 â€” Increment Counter

Inside perform, before sending email:

We must:

Increment counter

Set expires_in: 1.minute

Store result in variable

Using Rails.cache.increment

ğŸ‘‰ Write the line that increments the counter and sets 1 minute expiry.

Only that line.


###

class RideCompletionJob < ApplicationJob
	
	queue_as :mailers

	retry_on StandardError, attempts: 5

	def perform(ride_id)
		ride = Ride.find_by(id: ride_id)
		return unless ride&.completed?

		ride.with_lock do
			return if ride.completion_email_sent
			RideMailer.ride_completed(ride).deliver_now
			ride.update!(completion_email_sent: true)
		end
	end

end