ğŸ¯ Basic Task â€” Simple Rate Limiting Inside Job

Requirement:

Max 100 emails per minute

If limit exceeded â†’ raise error (so Sidekiq retries)

Assume Rails.cache uses Redis

No locking complexity yet

Step 1

Inside perform, before sending email:

We create a rate limit key based on current minute.

Example format (conceptually):

"email_rate_limit:#{current_minute}"


ğŸ‘‰ Write the line that builds a key using current minute timestamp.

Only that line.


####

class RideCompletionJob < ApplicationJob
	
	queue_as :default

	def perform(ride_id)
		ride = Ride.find_by(id: ride_id)
		return unless ride&.completed?
		RideMailer.ride_completed(ride).deliver_now
	end

	private

	def email_rate_limit_key
		"email_rate_limit:#{(Time.current.to_i)/60}"
	end
end
