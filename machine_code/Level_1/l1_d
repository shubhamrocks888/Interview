ğŸš€ Now Final Hard Twist

Interviewer says:

Sorting also required
GET /posts?status=published&page=2&sort=created_at_desc

Implement:

filtering

pagination

sorting

N+1 safe

This is final boss level.



##

def index
  posts = Post.includes(:user)

  # Filtering
  posts = posts.where(status: params[:status]) if params[:status].present?

  # Sorting
  if params[:sort].present?
    case params[:sort]
    when "created_at_desc"
      posts = posts.order(created_at: :desc)
    when "created_at_asc"
      posts = posts.order(created_at: :asc)
    else
      return render json: { error: "Invalid sort parameter" }, status: :bad_request
    end
  end

  # Pagination
  page = params[:page].to_i
  page = 1 if page <= 0

  per_page = 10
  total_count = posts.count

  posts = posts.limit(per_page)
               .offset((page - 1) * per_page)

  render json: {
    data: posts.as_json(
      only: [:id, :title, :status],
      include: { user: { only: [:id, :full_name, :email] } }
    ),
    meta: {
      current_page: page,
      per_page: per_page,
      total_count: total_count,
      total_pages: (total_count.to_f / per_page).ceil
    }
  }
end
