ğŸ” Devise Auto Logout (Timeoutable / Session Expiry)
1ï¸âƒ£ What module handles auto logout?
devise :timeoutable


Automatically logs out users after a period of inactivity

Configurable in config/initializers/devise.rb:

config.timeout_in = 30.minutes


Works for session-based login (and indirectly with remember-me)

2ï¸âƒ£ How auto logout works (high-level)

User logs in â†’ current_user set via Warden

Rails session is created:

session["warden.user.user.key"] = [[user.id], auth_salt]
session[:last_request_at] = Time.current.to_i


On every request, Devise checks:

if session[:last_request_at] < Time.current - timeout_in
  sign_out(current_user)
else
  session[:last_request_at] = Time.current.to_i
end


If timeout exceeded â†’ user automatically logged out

Otherwise â†’ last_request_at updated

3ï¸âƒ£ Where is this data stored?

Session cookie (browser) â†’ stores user_id, auth_salt, last_request_at

No DB updates required for timeoutable

Unlike trackable, timeoutable doesnâ€™t touch DB. Everything is session memory + cookie-based.

4ï¸âƒ£ Auto Logout with Remember-Me

Remember-me survives browser restart

If timeoutable is enabled:

After timeout period â†’ session expired

Devise can auto-login again using remember-me cookie

Session recreated automatically

Important: Devise still checks auth_salt to ensure session is valid

5ï¸âƒ£ Manual Logout (sign_out)

User clicks logout:

DELETE /users/sign_out


Devise does:

warden.logout(:user)
cookies.delete(:remember_user_token)
session.clear


This invalidates session immediately (also clears remember-me)

6ï¸âƒ£ Timeoutable Flow (Step-by-Step)
Login request
     â†“
Warden authenticates â†’ session created
     â†“
User activity â†’ each request updates session[:last_request_at]
     â†“
Request received
     â†“
Compare last_request_at with current_time
     â†“
If timeout exceeded â†’ sign_out â†’ session cleared â†’ redirect to login
Else â†’ continue â†’ update last_request_at

7ï¸âƒ£ Interview-Trap Points
Question	Correct Answer
Does timeoutable update DB?	âŒ No, session-only
Does it affect remember-me?	âœ… Can auto-login if remember-me exists
Is current_user immediately cleared on timeout?	âœ… Yes, next request triggers logout
Can user extend session by activity?	âœ… last_request_at updated on every request
8ï¸âƒ£ One-Line Interview Answer

â€œDeviseâ€™s timeoutable module automatically logs out users after a configurable period of inactivity. It tracks last_request_at in the session cookie, and if the user exceeds the timeout, Warden clears the session, logging the user out. No database updates are needed.â€