ğŸ§  Big picture (one-liner)

Action Mailer builds an email â†’ hands it to a delivery adapter â†’ adapter talks to an email server â†’ email server delivers to recipient mailbox.

ğŸ” Action Mailer Flow (step by step)

Letâ€™s assume:

UserMailer.welcome_email(user).deliver_later

1ï¸âƒ£ Mailer method is called
UserMailer.welcome_email(user)


This does NOT send email yet

It just builds a Mail::Message object

class UserMailer < ApplicationMailer
  def welcome_email(user)
    @user = user
    mail(to: user.email, subject: "Welcome")
  end
end

2ï¸âƒ£ Views are rendered (HTML / text)

Rails looks for:

app/views/user_mailer/welcome_email.html.erb
app/views/user_mailer/welcome_email.text.erb


ERB is rendered

Inline attachments are attached here

Email body is created

ğŸ“¦ Result: complete email content

3ï¸âƒ£ Delivery method is chosen

This is where Action Mailer hands off the email.

Configured in:

config/environments/production.rb


Examples:

config.action_mailer.delivery_method = :smtp
config.action_mailer.delivery_method = :sendmail
config.action_mailer.delivery_method = :test

4ï¸âƒ£ Email is passed to Mail gem

Rails uses the Mail gem internally.

The Mail gem:

Formats headers

Encodes body

Handles MIME (HTML + text + attachments)

Think of Mail gem as:

â€œThe postman who packs the envelopeâ€

5ï¸âƒ£ Adapter sends email (SMTP / API)
Example: SMTP
config.action_mailer.smtp_settings = {
  address: "smtp.gmail.com",
  port: 587,
  user_name: ENV["SMTP_USER"],
  password: ENV["SMTP_PASS"],
  authentication: "plain",
  enable_starttls_auto: true
}


Flow:

Rails â†’ Mail gem â†’ SMTP server â†’ Recipient inbox


SMTP server examples:

Gmail

Outlook

Amazon SES

SendGrid SMTP

6ï¸âƒ£ Recipient mail server receives it

Recipientâ€™s mail server:

Checks SPF / DKIM / DMARC

Filters spam

Delivers to inbox or spam

At this point, Rails is out of the picture.

ğŸš€ deliver_now vs deliver_later
deliver_now
UserMailer.welcome_email(user).deliver_now


Sends email synchronously

Blocks request

âŒ Bad for APIs

deliver_later
UserMailer.welcome_email(user).deliver_later


Enqueues ActiveJob

Background worker sends email

âœ… Production standard

Flow:

Controller â†’ Job Queue â†’ Worker â†’ Mailer â†’ SMTP

ğŸ§© Real production flow (Sidekiq example)
API request
   â†“
Mailer called
   â†“
ActiveJob created
   â†“
Sidekiq worker picks job
   â†“
Action Mailer builds email
   â†“
Mail gem formats email
   â†“
SMTP / SendGrid API
   â†“
Inbox

ğŸ§ª Environments behavior (important!)

| Env         | delivery_method   | What happens    |
| ----------- | ----------------- | --------------- |
| development | :letter_opener    | Opens browser   |
| test        | :test             | Stored in array |
| production  | :smtp / :sendgrid | Real email      |

Test example:

ActionMailer::Base.deliveries.count

âš ï¸ Common misconceptions (interview traps)

âŒ Rails sends email directly to Gmail
âœ… Rails sends to SMTP server, not inbox

âŒ Mailer sends email immediately
âœ… deliver_later sends asynchronously

âŒ HTML email works like web HTML
âœ… Email HTML is very limited

ğŸ’ Interview-ready explanation (30 seconds)

â€œAction Mailer builds a Mail::Message by rendering mailer views and attachments.
It then hands it to the Mail gem, which uses a configured delivery adapter like SMTP or SendGrid.
In production we use deliver_later, so email sending happens asynchronously via a background job.â€

ğŸ”¥ Bonus: API-based providers (SendGrid, SES)

Instead of SMTP:

Rails â†’ Mail gem â†’ Provider API â†’ Inbox


Advantages:

Better deliverability

Faster

Built-in retries