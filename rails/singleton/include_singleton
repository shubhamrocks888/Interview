When you write:

include Singleton


youâ€™re pulling in Rubyâ€™s built-in module:

ğŸ‘‰ Singleton

Letâ€™s break down what actually happens behind the scenes.

ğŸ” What include Singleton Really Does

When you include Singleton, Ruby does three major things:

1ï¸âƒ£ Makes .new Private

It prevents direct instantiation:

Logger.new   # âŒ NoMethodError


Internally it does something like:

private_class_method :new


So users cannot create new instances manually.

2ï¸âƒ£ Defines .instance Class Method

It adds a class method:

def self.instance
  @instance ||= new
end


This ensures:

First call â†’ creates object

Later calls â†’ returns same object

So this works:

Logger.instance
Logger.instance


Both return the same object.

3ï¸âƒ£ Makes It Thread-Safe

This is the important part most people miss.

The real implementation uses a Mutex to prevent race conditions:

def self.instance
  return @instance if @instance

  @mutex.synchronize do
    @instance ||= new
  end

  @instance
end


Without this, in multi-threaded apps (like Rails), two threads could create two objects simultaneously.

ğŸ“¦ Simplified Version of What Singleton Actually Looks Like

Hereâ€™s a simplified approximation of the real Ruby source:

module Singleton
  def self.included(base)
    base.extend(ClassMethods)
    base.private_class_method :new
  end

  module ClassMethods
    def instance
      @__instance__ ||= new
    end
  end
end


The real version in Ruby's stdlib is more complex and thread-safe.

ğŸ§  What include Actually Does in Ruby

When you write:

include Singleton


Ruby:

Inserts Singleton into the class's ancestor chain

Calls Singleton.included(self) if defined

Adds instance methods

Extends class with class methods

You can even check:

Logger.ancestors


Youâ€™ll see Singleton in the chain.

ğŸš€ Bonus: Where Is This Code Located?

It comes from Rubyâ€™s standard library:

require 'singleton'


File location (internally):

lib/singleton.rb


It is not Rails code â€” itâ€™s pure Ruby stdlib.

ğŸ”¥ Interview-Level Summary

When you include Singleton:

âœ” Makes .new private
âœ” Adds .instance method
âœ” Ensures only one object is created
âœ” Uses Mutex for thread safety
âœ” Stores instance in class-level variable