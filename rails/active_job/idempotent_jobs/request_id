What request_id really represents

One request_id = one business operation that must happen exactly once

Examples of a business operation:

â€œCharge â‚¹100 for order #ORD123â€

â€œProcess webhook event evt_789â€

â€œTransfer money for transaction TXN456â€

âŒ Wrong mental model

â€œrequest_id should be unique per userâ€

That would be wrong because:

A user can have many valid actions

You do want multiple jobs for the same user

Making it per-user would block legitimate work

âŒ Example:

request_id = user.id


This would prevent the same user from ever doing a second transaction ğŸ˜¬

âœ… Correct mental model

request_id must be unique per business event

Examples
1ï¸âƒ£ Order payment
request_id = order.id
CreditJob.perform_async(user.id, request_id)

2ï¸âƒ£ API request (no natural ID)
request_id = SecureRandom.uuid


Store it in DB and reuse on retries.

3ï¸âƒ£ Webhook processing
request_id = webhook_event_id


Webhook providers expect idempotency.

Step-by-step example
User does two different payments
Action	user_id	request_id
Pay order #101	42	ORD101
Pay order #102	42	ORD102

âœ” Same user
âœ” Different business actions
âœ” Both allowed

When SHOULD the request_id be reused?

You reuse the same request_id when:

API retries

Job retries

Sidekiq crash + restart

Webhook replay

User double-clicks

One-line rule (memorize this)

Same business action â†’ same request_id
Different business action â†’ different request_id

Interview-ready answer ğŸ”¥

The request_id is a business-level idempotency key. It should be unique per business operation, not per user. The same request_id is reused across retries or duplicate enqueues to ensure the operation is executed exactly once.	