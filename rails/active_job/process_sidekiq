What is the processes key?

ğŸ‘‰ processes is a Redis SET.

It contains all currently alive Sidekiq processes.

Example:

processes
= {
  "sidekiq:host1:12345",
  "sidekiq:host1:12346",
  "sidekiq:host2:9876"
}


Each entry represents one Sidekiq process, not a worker thread.

STEP 1 â€” When Sidekiq starts

When a Sidekiq process boots:

It generates a unique process identity

sidekiq:<hostname>:<pid>


It writes itself to Redis:

SADD processes sidekiq:host1:12345


Now Redis knows:

â€œThis Sidekiq process is alive.â€

STEP 2 â€” Heartbeat (this is critical)

Every ~5 seconds, Sidekiq sends a heartbeat.

Heartbeat does two things:

1ï¸âƒ£ Refresh process metadata

Stored under:

sidekiq:host1:12345


This key contains JSON like:

{
  "busy": 2,
  "concurrency": 10,
  "queues": ["default"],
  "started_at": 1700000000,
  "beat": 1700000050
}


ğŸ‘‰ beat = last heartbeat timestamp

2ï¸âƒ£ Confirms liveness

As long as:

the process keeps heartbeating

beat keeps updating

Sidekiq assumes:
âœ… process is alive

STEP 3 â€” Worker entries depend on processes

When a worker thread starts a job, Sidekiq writes an entry to:

workers   (Redis HASH)


Key:

sidekiq:host1:12345:<thread_id>


Value:

{
  "queue": "default",
  "jid": "abc123",
  "run_at": 1700000100
}


ğŸ“Œ Notice:
ğŸ‘‰ Worker entry is linked to the process identity

STEP 4 â€” Process crashes ğŸ’¥

What happens in Redis?

âŒ No more heartbeat
âŒ beat timestamp stops updating

So Redis now has:

Worker entries pointing to a process

But that process is stale

STEP 5 â€” How Sidekiq uses processes to detect crashes

Sidekiq periodically does:

Read all entries in:

processes


For each process:

Fetch its metadata key

Check beat

If:

current_time - beat > timeout


ğŸ‘‰ Process is considered dead

STEP 6 â€” Cleanup & recovery

When a process is dead:

1ï¸âƒ£ Remove it from processes
SREM processes sidekiq:host1:12345

2ï¸âƒ£ Remove its worker entries
HDEL workers sidekiq:host1:12345:<thread_id>

3ï¸âƒ£ Requeue its jobs

Jobs referenced by those worker entries

Are put back into their original queues

Why processes key is needed (big picture)

Without processes:

Sidekiq wouldnâ€™t know which workers belong to which process

It couldnâ€™t distinguish:

slow jobs

crashed processes

processes = source of truth for liveness

Interview one-liner ğŸ”¥

If interviewer asks â€œWhat is the purpose of the processes key in Redis?â€:

Sidekiq uses the processes set as a registry of active Sidekiq processes. Each process heartbeats to Redis, and if a process stops heartbeating, Sidekiq detects it as dead, cleans up its worker entries, and re-queues any in-progress jobs.