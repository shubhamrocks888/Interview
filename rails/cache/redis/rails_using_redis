1ï¸âƒ£ Rails.cache (MOST IMPORTANT)

Rails.cache is a high-level abstraction.

ğŸ”´ Important rule
Rails.cache ALWAYS stores values as a Redis STRING
(even if you write a Hash, Array, or AR object)

Rails serializes the value before storing it.

ğŸ”¹ 1.1 Store & read primitive values
Rails.cache.write("count", 10)
Rails.cache.read("count")

What Redis stores

Type: STRING

Value: Marshal.dump(10)

Rails.cache.write("flag", true)
Rails.cache.read("flag")


Stored as STRING

Value = Marshal.dump(true)

ğŸ”¹ 1.2 Store Hash / Array
Rails.cache.write("settings", { theme: "dark", lang: "en" })
Rails.cache.read("settings")

Internally
Redis key: "settings"
Redis type: STRING
Value: Marshal.dump({ theme: "dark", lang: "en" })


Rails does:

Marshal.dump(value)  -> redis.set
Marshal.load(value)  -> redis.get

ğŸ”¹ 1.3 Store ActiveRecord object (âš ï¸ risky)
Rails.cache.write("user", User.first)
Rails.cache.read("user")


Redis type: STRING

Value: binary (Marshal dump of AR object)

Read returns full User object

âš ï¸ Problem: schema change â†’ stale cache â†’ crash

ğŸ”¹ 1.4 Safer approach (recommended)
Rails.cache.write("user", User.first.as_json)
Rails.cache.read("user")


Stored as STRING

Value: Marshal.dump(Hash)

Read returns Hash

âœ… No schema coupling

2ï¸âƒ£ Rails.cache options
Rails.cache.write(
  "user_1",
  User.first.as_json,
  expires_in: 10.minutes
)


Redis command:

SET user_1 <binary>
EX 600

3ï¸âƒ£ Direct Redis usage in Rails (LOW LEVEL)

When you want real Redis data types, you must use Redis directly.

redis = Redis.new

ğŸ”¹ 3.1 STRING
redis.set("name", "Shubham")
redis.get("name")


Redis type: STRING

ğŸ”¹ 3.2 HASH
redis.hset("user:1", "name", "Alice")
redis.hset("user:1", "email", "a@test.com")

redis.hget("user:1", "name")
redis.hgetall("user:1")


Redis type: HASH

ğŸ”¹ 3.3 LIST (Queue)
redis.lpush("jobs", "email")
redis.rpop("jobs")


Redis type: LIST

ğŸ”¹ 3.4 SET
redis.sadd("roles", "admin")
redis.smembers("roles")


Redis type: SET

ğŸ”¹ 3.5 SORTED SET
redis.zadd("leaderboard", 100, "alice")
redis.zrange("leaderboard", 0, -1, with_scores: true)


Redis type: ZSET

4ï¸âƒ£ Rails.cache vs Direct Redis (CRITICAL DIFFERENCE)
Feature	Rails.cache	Direct Redis
Redis types	âŒ Always STRING	âœ… All types
Serialization	Marshal	Manual
Use case	Caching	Data structures
TTL support	âœ…	âœ…
AR objects	âš ï¸ Risky	âŒ Not stored
5ï¸âƒ£ Which should YOU use?
âœ… Use Rails.cache when:

Caching DB queries

Caching API responses

Simple key/value

âœ… Use direct Redis when:

Queues

Counters

Rate limiting

Leaderboards

Sets / Hashes

6ï¸âƒ£ Mental model (THIS WILL CLICK)
Rails.cache
  â†“
Marshal.dump
  â†“
Redis STRING

redis.hset / lpush / zadd
  â†“
Native Redis data types

7ï¸âƒ£ Common mistakes (learn this early)

âŒ Assuming Rails.cache HASH = Redis HASH
âŒ Storing AR objects long-term
âŒ Mixing JSON + Marshal without clarity